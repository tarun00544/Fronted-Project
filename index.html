  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .gradient-card {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .gradient-card.success {
            background: var(--success-gradient);
        }

        .gradient-card.warning {
            background: var(--warning-gradient);
        }

        .gradient-card.danger {
            background: var(--danger-gradient);
        }

        .timetable-header {
            background: var(--primary-gradient);
            color: white;
        }

        .period-cell {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .class-card {
            border-radius: 8px;
            border-left: 4px solid #007bff;
            background-color: #e3f2fd;
            transition: all 0.3s ease;
            cursor: move;
        }

        .class-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .class-card.locked {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }

        .empty-slot {
            min-height: 80px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .empty-slot.dragover {
            border-color: #007bff;
            background-color: #e3f2fd;
        }

        .data-card {
            transition: all 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            border-radius: 8px;
        }

        .stat-card {
            border-radius: 12px;
            overflow: hidden;
        }

        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container">
            <div class="navbar-brand d-flex align-items-center">
                <i class="fas fa-calendar-alt text-primary me-3 fs-3"></i>
                <h1 class="h3 mb-0 text-dark">Timetable Manager</h1>
            </div>
            
            <div class="d-flex">
                <ul class="nav nav-tabs border-0">
                    <li class="nav-item">
                        <button class="nav-link active" id="dashboard-tab" onclick="switchTab('dashboard')">
                            <i class="fas fa-home me-2"></i>Dashboard
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="data-tab" onclick="switchTab('data')">
                            <i class="fas fa-database me-2"></i>Data Management
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Dashboard Tab -->
        <div id="dashboard-content" class="tab-content">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card gradient-card h-100">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Sections</h6>
                                <h2 class="mb-0" id="sections-count">0</h2>
                            </div>
                            <i class="fas fa-users fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card gradient-card success h-100">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Teachers</h6>
                                <h2 class="mb-0" id="teachers-count">0</h2>
                            </div>
                            <i class="fas fa-user fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card gradient-card warning h-100">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Rooms</h6>
                                <h2 class="mb-0" id="rooms-count">0</h2>
                            </div>
                            <i class="fas fa-door-open fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card gradient-card danger h-100">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Subjects</h6>
                                <h2 class="mb-0" id="subjects-count">0</h2>
                            </div>
                            <i class="fas fa-book fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timetable Generation -->
            <div class="card shadow-lg">
                <div class="card-body">
                    <h3 class="card-title mb-4">
                        <i class="fas fa-plus-circle me-2"></i>Generate New Timetable
                    </h3>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Select Section</label>
                            <select id="section-select" class="form-select form-select-lg">
                                <option value="">Choose a section...</option>
                            </select>
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                            <button id="generate-btn" class="btn btn-gradient btn-lg w-100" onclick="generateTimetable()">
                                <i class="fas fa-plus me-2"></i>Generate Timetable
                            </button>
                        </div>
                    </div>

                    <!-- Generated Timetable -->
                    <div id="timetable-container" class="d-none">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="mb-0">Generated Timetable</h4>
                            <div class="text-muted">
                                Total Classes: <span id="total-classes">0</span>
                            </div>
                        </div>
                        <div id="timetable-grid"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Tab -->
        <div id="data-content" class="tab-content d-none">
            <div class="row">
                <!-- Subjects -->
                <div class="col-lg-6 mb-4">
                    <div class="card data-card shadow">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-book me-2"></i>Subjects
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="subjects-list" class="overflow-auto" style="max-height: 300px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Teachers -->
                <div class="col-lg-6 mb-4">
                    <div class="card data-card shadow">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-users me-2"></i>Teachers
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="teachers-list" class="overflow-auto" style="max-height: 300px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Rooms -->
                <div class="col-lg-6 mb-4">
                    <div class="card data-card shadow">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-door-open me-2"></i>Rooms
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="rooms-list" class="overflow-auto" style="max-height: 300px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Sections -->
                <div class="col-lg-6 mb-4">
                    <div class="card data-card shadow">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-layer-group me-2"></i>Sections
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="sections-list" class="overflow-auto" style="max-height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let activeTab = 'dashboard';
        let subjects = [];
        let teachers = [];
        let rooms = [];
        let sections = [];
        let currentTimetable = {};
        let selectedSection = null;
        let editMode = false;
        let draggedItem = null;

        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        const periods = [1, 2, 3, 4, 5, 6, 7, 8];

        // Initialize sample data
        function initializeSampleData() {
            subjects = [
                { id: 1, name: 'Mathematics', code: 'MATH101', hours_per_week: 5, requires_lab: false },
                { id: 2, name: 'Physics', code: 'PHY101', hours_per_week: 4, requires_lab: true },
                { id: 3, name: 'English', code: 'ENG101', hours_per_week: 3, requires_lab: false },
                { id: 4, name: 'Java', code: 'Jav101', hours_per_week: 4, requires_lab: true },
                { id: 5, name: 'Python', code: 'Pyt101', hours_per_week: 5, requires_lab: true },
                { id: 6, name: 'Data Structures', code: 'DS101', hours_per_week: 4, requires_lab: true },
                { id: 7, name: 'Web Development', code: 'WEB101', hours_per_week: 3, requires_lab: true },
                { id: 8, name: 'Environmental Science', code: 'EVS101', hours_per_week: 4, requires_lab: false }
            ];

            teachers = [
                { id: 1, name: 'Dr. Brijesh singh', department: 'Mathematics' },
                { id: 2, name: 'Prof. Neha', department: 'Physics' },
                { id: 3, name: 'Dr. Shubham sharma', department: 'Chemistry' },
                { id: 4, name: 'Ms. Brahmjot kaur', department: 'English' },
                { id: 5, name: 'Dr. kanchan sharma', department: 'Java' },
                { id: 6, name: 'Mr. Amandeep kaur', department: 'Python' },
                { id: 7, name: 'Ms. Navneet kaur', department: 'Data Structures' },
                { id: 8, name: 'Mr. Manju goyal', department: 'C++' },
                { id: 9, name: 'Ms. Mudit ', department: 'Web Development' },
                { id: 10, name: 'Dr. Jayishnu Singla', department: 'Environmental Science' }
            ];

            rooms = [
                { id: 1, name: 'Room 101', capacity: 40, room_type: 'lecture', building: 'A' },
                { id: 2, name: 'Lab 201', capacity: 30, room_type: 'lab', building: 'B' },
                { id: 3, name: 'Room 102', capacity: 35, room_type: 'lecture', building: 'A' },
                { id: 4, name: 'Lab 202', capacity: 25, room_type: 'lab', building: 'B' },
                { id: 5, name: 'Seminar Hall', capacity: 70, room_type: 'seminar', building: 'C' },
                { id: 6, name: 'Room 103', capacity: 45, room_type: 'lecture', building: 'A' },
                { id: 7, name: 'Lab 203', capacity: 20, room_type: 'lab', building: 'B' },
                { id: 8, name: 'Room 104', capacity: 50, room_type: 'lecture', building: 'A' },
                { id: 9, name: 'Lab 204', capacity: 30, room_type: 'lab', building: 'B' },
                { id: 10, name: 'Conference Hall', capacity: 100, room_type: 'seminar', building: 'C' },
                { id: 11, name: 'Room 105', capacity: 40, room_type: 'lecture', building: 'A' },
                { id: 12, name: 'Lab 205', capacity: 35, room_type: 'lab', building: 'B' },
                { id: 13, name: 'Room 106', capacity: 30, room_type: 'lecture', building: 'A' },
                { id: 14, name: 'Lab 206', capacity: 25, room_type: 'lab', building: 'B' },
                { id: 15, name: 'Auditorium', capacity: 150, room_type: 'seminar', building: 'C' }
            ];

            sections = [
                { id: 1, name: 'CS-A', year: 1, department: 'Computer Science', strength: 35 },
                { id: 2, name: 'CS-B', year: 1, department: 'Computer Science', strength: 30 },
                { id: 3, name: 'CS-C', year: 2, department: 'Computer Science', strength: 50 },
                { id: 4, name: 'IT-A', year: 1, department: 'Information Technology', strength: 40 },
                { id: 5, name: 'IT-B', year: 2, department: 'Information Technology', strength: 45 },
                { id: 6, name: 'EC-A', year: 1, department: 'Electronics', strength: 25 },
                { id: 7, name: 'EC-B', year: 2, department: 'Electronics', strength: 30 },
                { id: 8, name: 'ME-A', year: 1, department: 'Mechanical', strength: 20 },
                { id: 9, name: 'ME-B', year: 2, department: 'Mechanical', strength: 22 },
                { id: 10, name: 'CE-A', year: 1, department: 'Civil', strength: 28 },
                { id: 11, name: 'CE-B', year: 2, department: 'Civil', strength: 32 }
            ];

            updateStatCards();
            populateSectionSelect();
            renderDataLists();
        }

        // Switch tabs
        function switchTab(tab) {
            // Update active tab
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('d-none'));
            document.getElementById(tab + '-content').classList.remove('d-none');

            activeTab = tab;
        }

        // Update stat cards
        function updateStatCards() {
            document.getElementById('sections-count').textContent = sections.length;
            document.getElementById('teachers-count').textContent = teachers.length;
            document.getElementById('rooms-count').textContent = rooms.length;
            document.getElementById('subjects-count').textContent = subjects.length;
        }

        // Populate section select
        function populateSectionSelect() {
            const select = document.getElementById('section-select');
            select.innerHTML = '<option value="">Choose a section...</option>';
            
            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = `${section.name} - ${section.department}`;
                select.appendChild(option);
            });

            select.addEventListener('change', function() {
                selectedSection = this.value ? parseInt(this.value) : null;
            });
        }

        // Render data lists
        function renderDataLists() {
            // Render subjects
            const subjectsList = document.getElementById('subjects-list');
            subjectsList.innerHTML = '';
            subjects.forEach(subject => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-light rounded mb-3';
                item.innerHTML = `
                    <div class="fw-bold">${subject.name}</div>
                    <div class="text-muted small">${subject.code} • ${subject.hours_per_week}h/week</div>
                    ${subject.requires_lab ? '<div class="text-primary small mt-1"><i class="fas fa-flask me-1"></i>Requires Lab</div>' : ''}
                `;
                subjectsList.appendChild(item);
            });

            // Render teachers
            const teachersList = document.getElementById('teachers-list');
            teachersList.innerHTML = '';
            teachers.forEach(teacher => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-light rounded mb-3';
                item.innerHTML = `
                    <div class="fw-bold">${teacher.name}</div>
                    <div class="text-muted small">${teacher.department}</div>
                `;
                teachersList.appendChild(item);
            });

            // Render rooms
            const roomsList = document.getElementById('rooms-list');
            roomsList.innerHTML = '';
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-light rounded mb-3';
                item.innerHTML = `
                    <div class="fw-bold">${room.name}</div>
                    <div class="text-muted small">
                        Capacity: ${room.capacity} • Type: ${room.room_type} • Building ${room.building}
                    </div>
                `;
                roomsList.appendChild(item);
            });

            // Render sections
            const sectionsList = document.getElementById('sections-list');
            sectionsList.innerHTML = '';
            sections.forEach(section => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-light rounded mb-3';
                item.innerHTML = `
                    <div class="fw-bold">${section.name}</div>
                    <div class="text-muted small">
                        Year ${section.year} • ${section.department} • ${section.strength} students
                    </div>
                `;
                sectionsList.appendChild(item);
            });
        }

        // Generate timetable
        async function generateTimetable() {
            if (!selectedSection) {
                alert('Please select a section first');
                return;
            }

            const btn = document.getElementById('generate-btn');
            btn.innerHTML = '<div class="loading-spinner border-2 border-white border-top-transparent rounded-circle me-2" style="width: 20px; height: 20px;"></div>Generating...';
            btn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                currentTimetable = generateMockTimetable();
                renderTimetable();
                document.getElementById('timetable-container').classList.remove('d-none');
                
                btn.innerHTML = '<i class="fas fa-plus me-2"></i>Generate Timetable';
                btn.disabled = false;
            }, 2000);
        }

        // Generate mock timetable
        function generateMockTimetable() {
            const timetable = {};
            days.forEach(day => {
                timetable[day] = {};
                periods.forEach(period => {
                    timetable[day][period] = null;
                });
            });

               const mockClasses = [
                { day: 'Monday', period: 1, subject: 'Mathematics', teacher: 'Dr. Brijesh singh', room: 'Room 101' },
                { day: 'Monday', period: 2, subject: 'Physics', teacher: 'Prof. Neha', room: 'Lab 201' },
                { day: 'Monday', period: 4, subject: 'English', teacher: 'Ms. Brahmjot kaur', room: 'Room 102' },
                { day: 'Monday', period: 5, subject: 'Data Structures', teacher: 'Ms. Navneet kaur', room: 'Room 101' },
                { day: 'Monday', period: 6, subject: 'Python', teacher: 'Dr. Amandeep kaur', room: 'Lab 202' },
                { day: 'Monday', period: 3, subject: 'C++', teacher: 'Dr. Manju goyal', room: 'Lab 201' },
                { day: 'Tuesday', period: 1, subject: 'Chemistry', teacher: 'Dr. Shubham sharma', room: 'Lab 202' },
                { day: 'Tuesday', period: 3, subject: 'Java', teacher: 'Dr. Kanchan sharma', room: 'Lab 201' },
                { day: 'Tuesday', period: 4, subject: 'Web Development', teacher: 'Ms. Mudit', room: 'Lab 201' },
                { day: 'Tuesday', period: 2, subject: 'Environmental Science', teacher: 'Dr. Jayishnu Singla', room: 'Room 103' },
                { day: 'Tuesday', period: 5, subject: 'Environmental Science', teacher: 'Dr. Jayishnu Singla', room: 'Room 103' },
                { day: 'Wednesday', period: 2, subject: 'Mathematics', teacher: 'Dr. Brijesh singh', room: 'Room 101' },
                { day: 'Wednesday', period: 5, subject: 'Physics', teacher: 'Prof. Neha', room: 'Lab 201' },
                { day: 'Wednesday', period: 3, subject: 'C++', teacher: 'Dr. Manju goyal', room: 'Lab 201' },
                { day: 'Wednesday', period: 4, subject: 'Java', teacher: 'Dr. Kanchan sharma', room: 'Lab 201' },
                { day: 'Wednesday', period: 6, subject: 'Chemistry', teacher: 'Dr. Shubham sharma', room: 'Lab 202' },
                { day: 'Thursday', period: 1, subject: 'English', teacher: 'Ms. Brahmjot kaur', room: 'Room 102' },
                { day: 'Thursday', period: 3, subject: 'Python', teacher: 'Dr. Amandeep kaur', room: 'Lab 202' },
                { day: 'Thursday', period: 2, subject: 'Environmental Science', teacher: 'Dr. Jayishnu Singla', room: 'Room 103' },
                { day: 'Thursday', period: 4, subject: 'Web Development', teacher: 'Ms. Mudit', room: 'Lab 201' },
                { day: 'Friday', period: 1, subject: 'Data Structures', teacher: 'Ms. Navneet kaur', room: 'Room 101' },
                { day: 'Friday', period: 2, subject: 'C++', teacher: 'Dr. Manju goyal', room: 'Lab 201' },
                { day: 'Friday', period: 4, subject: 'Data Structures', teacher: 'Ms. Navneet kaur', room: 'Room 101' },
                { day: 'Friday', period: 5, subject: 'Mathematics', teacher: 'Dr. Brijesh singh', room: 'Room 101' }

            ];


            mockClasses.forEach(cls => {
                timetable[cls.day][cls.period] = {
                    subject: cls.subject,
                    teacher: cls.teacher,
                    room: cls.room,
                    is_locked: false
                };
            });

            return timetable;
        }

        // Render timetable
        function renderTimetable() {
            const container = document.getElementById('timetable-grid');
            const selectedSectionObj = sections.find(s => s.id == selectedSection);
            
            // Count total classes
            let totalClasses = 0;
            Object.values(currentTimetable).forEach(day => {
                totalClasses += Object.values(day).filter(period => period !== null).length;
            });
            document.getElementById('total-classes').textContent = totalClasses;

            container.innerHTML = `
                <div class="card shadow-lg">
                    <div class="card-header timetable-header">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <h4 class="mb-0">
                                <i class="fas fa-calendar-alt me-2"></i>
                                Timetable - ${selectedSectionObj ? selectedSectionObj.name : 'Unknown Section'}
                            </h4>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-light btn-sm" onclick="toggleEditMode()">
                                    <i class="fas fa-edit me-1"></i>${editMode ? 'Save' : 'Edit'}
                                </button>
                                <button class="btn btn-light btn-sm" onclick="exportToPDF()">
                                    <i class="fas fa-file-pdf me-1"></i>PDF
                                </button>
                                <button class="btn btn-light btn-sm" onclick="exportToCSV()">
                                    <i class="fas fa-download me-1"></i>CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="period-cell">Period</th>
                                        ${days.map(day => `<th class="text-center" style="min-width: 200px;">${day}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${periods.map(period => `
                                        <tr>
                                            <td class="period-cell">
                                                <i class="fas fa-clock me-2 text-muted"></i>
                                                Period ${period}
                                            </td>
                                            ${days.map(day => `
                                                <td class="p-2" 
                                                    ondragover="${editMode ? 'allowDrop(event)' : ''}" 
                                                    ondrop="${editMode ? `drop(event, '${day}', ${period})` : ''}">
                                                    ${renderTimetableCell(day, period)}
                                                </td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render individual timetable cell
        function renderTimetableCell(day, period) {
            const classData = currentTimetable[day]?.[period];
            
            if (classData) {
                return `
                    <div class="class-card p-3 ${classData.is_locked ? 'locked' : ''}" 
                         draggable="${editMode}" 
                         ondragstart="${editMode ? `drag(event, '${day}', ${period})` : ''}">
                        <div class="fw-bold text-dark mb-1">${classData.subject}</div>
                        <div class="text-muted small d-flex align-items-center mb-1">
                            <i class="fas fa-user me-1"></i>${classData.teacher}
                        </div>
                        <div class="text-muted small d-flex align-items-center">
                            <i class="fas fa-map-marker-alt me-1"></i>${classData.room}
                        </div>
                        ${classData.is_locked ? '<div class="text-warning small mt-1"><i class="fas fa-lock me-1"></i>Locked</div>' : ''}
                    </div>
                `;
            } else {
                return `
                    <div class="empty-slot">
                        ${editMode ? 'Drop here' : 'Free'}
                    </div>
                `;
            }
        }

        // Drag and drop functions
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('dragover');
        }

        function drag(ev, day, period) {
            draggedItem = {
                ...currentTimetable[day][period],
                oldDay: day,
                oldPeriod: period
            };
            ev.dataTransfer.effectAllowed = 'move';
        }

        function drop(ev, day, period) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('dragover');
            
            if (!draggedItem || !editMode) return;

            // Remove from old position
            if (draggedItem.oldDay && draggedItem.oldPeriod) {
                currentTimetable[draggedItem.oldDay][draggedItem.oldPeriod] = null;
            }

            // Add to new position
            currentTimetable[day][period] = {
                subject: draggedItem.subject,
                teacher: draggedItem.teacher,
                room: draggedItem.room,
                is_locked: true
            };

            draggedItem = null;
            renderTimetable();
        }

        // Toggle edit mode
        function toggleEditMode() {
            editMode = !editMode;
            renderTimetable();
        }

        // Export functions
        function exportToPDF() {
            alert('Exporting to PDF...');
        }

        function exportToCSV() {
            alert('Exporting to CSV...');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleData();
        });
    </script>
</body>

</html>
